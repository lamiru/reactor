#!bin/bash

packages() {
  source .packages/bin/activate
  pip install -r requirements.txt
}

migrate() {
  python manage.py makemigrations
  python manage.py migrate
  echo "from django.contrib.auth.models import User; None if User.objects.filter(username='admin').exists() else User.objects.create_superuser('admin', '', 'password2')" | python manage.py shell
  python manage.py loaddata fixtures/*.yaml
}

hamlpy() {
  hamlpy-watcher . &
}

runserver() {
  python manage.py runserver &
}

kill() {
  pkill -f 'python manage.py runserver'
  echo 'killed manage.py runserver...'
  pkill -f 'hamlpy-watcher'
  echo 'killed hamlpy-watcher...'
  echo
}

case "$1" in
  packages)
    packages
    ;;

  migrate)
    migrate
    ;;

  hamlpy)
    hamlpy
    ;;

  runserver)
    runserver
    ;;

  all)
    packages
    migrate
    hamlpy
    runserver
    ;;

  kill)
    kill
    ;;
esac
