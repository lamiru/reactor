{% extends "_layout.html" %}
{% load bootstrap3 %}
{% block css %}
{% endblock %}
{% block content %}
.container
  .row
    {% include "topics/_searchform.html" %}
{% for topic in topic_list %}
.container
  .row
    .col-xs-12
      .panel.panel-default
        .panel-heading
          .pull-left
            {% include "_user.html" %}
          .pull-right
            .large.pt-10 Topic Score {{ topic.topic_score }}
          .clearfix
        .panel-body
          %a{href: '{% url "reactions:detail" topic.pk %}'}
            .strong {{ topic.title }}
          %div {{ topic.contents }}
{% endfor %}
{% if user.is_authenticated %}
.container
  .row
    %form.topic-new-form{action: '{% url "topics:new" %}', method: 'POST', enctype: 'multipart/form-data'}
      {% csrf_token %}
      .col-xs-10
        {% bootstrap_form rform show_label=False %}
      .col-xs-2.button-wrapper
        {% buttons %}
        %button.btn.btn-primary.width-100p Create Topic
        {% endbuttons %}
      .col-xs-12
        .thumbnail.well
          .thumbnail-close
            {% bootstrap_icon 'remove' %}
          .thumbnail-url-image
          %a.thumbnail-url{target: '_blank'}
            %span.thumbnail-url-title
          .thumbnail-url-description
{% endif %}
{% endblock %}
{% block javascript %}
:javascript
  $('textarea').liveUrl({
    success: function(data){
      $('#id_url').val(data.url);
      $('#id_url_title').val(data.title);
      $('#id_url_description').val(data.description);
      $('#id_url_image').val(data.image);
      if(data.image) {
        $('form .thumbnail-url-image').css('background-image', 'url(' + data.image + ')');
        $('form .thumbnail-url-image').show();
      }
      $('form .thumbnail-url').attr('href', data.url);
      $('form .thumbnail-url-title').html(data.title);
      $('form .thumbnail-url-description').html(data.description);
      $('form .thumbnail').show();
    }
  });
  $('.thumbnail-close').click(function(){
    $('#id_url').val('');
    $('#id_url_title').val('');
    $('#id_url_description').val('');
    $('#id_url_image').val('');
    $('form .thumbnail').hide();
  });
{% endblock %}
